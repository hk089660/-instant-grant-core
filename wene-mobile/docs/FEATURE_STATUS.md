# モバイルアプリ・管理者アプリ 機能一覧

現状の「機能している」「機能していない」「未実装」を一覧にしたものです。

---

## モバイルアプリ（利用者向け）

### 機能している

| 機能 | 説明 |
|------|------|
| ホーム | モードに応じて「参加を開始」→ `/u` または「受け取りを開始」→ `/r/...` へ遷移。デモリンク/QR も遷移可能。 |
| イベント一覧 (`/u`) | モックイベント（adminMock）を表示。未完了/完了済みを participationStore + recipientTicketStore で判定して表示。 |
| スキャン画面 (`/u/scan`) | ボタンで「読み取り開始」→ 確認画面へ遷移。**カメラ/QR 読み取りは未実装のためモック遷移のみ。** |
| 確認画面 (`/u/confirm`) | eventId からイベント情報表示。「参加する」で useSchoolClaim → モック API で参加処理。成功/既参加/エラー（リトライ可）の分岐。 |
| 参加 API（モック） | evt-001 成功、evt-002 既参加、evt-003 リトライ可能エラー。実機では recipientTicketStore にチケット保存。 |
| 成功画面 (`/u/success`) | 参加完了後に表示。participationStore の completed 記録。「完了」でイベント一覧へ戻る。 |
| データ永続化 | 参加チケットは recipientTicketStore（AsyncStorage）。参加状態は participationStore（AsyncStorage）。 |
| デフォルトモード | `claimMode` は `school`。ウォレット不要の参加券フローがデフォルト。 |

### 機能していない・部分実装

| 機能 | 状況 |
|------|------|
| QR スキャン | カメラプレビューは「モック」表示のみ。実際のカメラ/QR 読み取りは未実装。ボタンで確認画面へ遷移するのみ。 |
| 成功画面の確認コード | 固定で `#A7F3` を表示。実際のチケットの確認コード（joinedAt 等から生成）を表示していない。 |
| 受付時間外・QR 期限切れ | TODO コメントのみ。表示・ブロック処理は未実装。 |

### 未実装

| 機能 | 説明 |
|------|------|
| 実機での QR コード読み取り | expo-camera / バーコードスキャンライブラリの組み込み。 |
| 参加申込の実 API | 現状は SchoolClaimClient のモックのみ。fetch 等の実装に差し替えが必要。 |
| イベントデータの実 API | イベント一覧・詳細は adminMock + schoolEvents のモックのみ。 |

---

## 管理者アプリ（`/admin/*`）

### 機能している

| 機能 | 説明 |
|------|------|
| 管理者トップ (`/admin`) | イベント一覧。**同期済みデータ**（adminUserSync）で rtCount を表示。カテゴリタブ・ロール表示。 |
| イベント詳細 (`/admin/events/[eventId]`) | イベント情報・リアルタイム参加数・total 参加数。**参加者一覧は同期データ**（recipientTicketStore 由来 + モック）。戻る・印刷用 PDF への導線。 |
| 参加者検索 (`/admin/participants`) | 参加者ログ一覧（同期の participantLogs + mockParticipantLogs）。検索バーは UI のみ（後述）。 |
| 印刷画面 (`/admin/print/[eventId]`) | admin ロール時のみ印刷可能。`window.print()` でブラウザ印刷。@media print で非印刷要素を非表示。**イベント名・日時・主催は固定表示（後述）。** |
| カテゴリ管理 (`/admin/categories`) | モックカテゴリ一覧表示。admin のみ編集エリア表示。編集・削除・並び替え・追加ボタンは **未実装（onPress 空）。** |
| ログイン (`/admin/login`) | 画面のみ。「管理者として続行」「閲覧モードで開く」いずれも `/admin` へ遷移。認証ロジックなし。 |
| ロール切替 | viewer / operator / admin。getMockAdminRole で保持。DevRoleSwitcher で開発時に切替可能。 |
| 管理者⇔利用者データ同期 | 利用者の参加結果が recipientTicketStore に保存され、管理者のイベント一覧・詳細・参加者で参照される。同一アプリ内で即時反映。 |

### 機能していない・部分実装

| 機能 | 状況 |
|------|------|
| 印刷画面のイベント内容 | タイトル・日時・主催が「地域清掃ボランティア」「2026/02/02 09:00-10:30」「生徒会」で固定。eventId に応じた動的表示は未実装。 |
| QR 表示（詳細画面） | 「QRを表示」ボタンは `onPress={() => {}}` で何もしない。QR プレビューは「モック」テキストのみ。 |
| QR コード画像 | 印刷画面では「QRプレビュー（印刷用）」と URL テキスト表示。実際の QR 画像生成・表示は未実装。 |
| 参加者検索のフィルタ | AdminSearchBar で query は state に保存されるが、一覧のフィルタリングに使っていない。検索は UI のみ。 |
| CSV ダウンロード | ボタンは admin 時に表示されるが `onPress={() => {}}` で未実装。 |
| イベント作成 | 「イベント作成」ボタンは `onPress={() => {}}` で未実装。 |

### 未実装

| 機能 | 説明 |
|------|------|
| 認証 | ログイン画面はモック。実際の認証・セッション管理なし。 |
| イベント作成・編集・終了 | API も UI も未実装。 |
| カテゴリの編集・削除・並び替え・追加 | ボタンはあるが処理なし。 |
| QR コード画像の生成・表示 | ライブラリ（例: qrcode）で URL を QR 化して表示・印刷に含める。 |
| CSV エクスポート | 参加者一覧を CSV でダウンロード。 |
| イベント別の印刷内容 | 印刷画面で eventId に応じてイベント名・日時・主催・QR URL を動的に表示。 |
| バックエンド API | イベント・参加者・認証の実サーバーは未実装。現状はモック + ローカル store のみ。 |

---

## 共通・その他

### 機能している

- **Doctor スクリプト**: 必須/禁止パターン、依存、Android 設定、アセット、ビルド修復（`doctor:build-repair`）。
- **クリーンインストール**: ルートの `npm run clean-install` / `clean-install:pull`。
- **Phantom / Solana 受け取りフロー** (`/r/[campaignId]`, ReceiveScreen): claimMode が `solana` のときの既存フロー。接続→署名→送信→確認は Android で検証済み（devnet）。

### 未実装・別モード

- **本番用 API**: 参加申込・イベント取得・認証の実サーバー。
- **複数デバイス間の管理者・利用者同期**: 現状は同一アプリ内の store 共有のみ。別端末間の同期にはバックエンドが必要。

---

## まとめ

| 区分 | モバイル（利用者） | 管理者 |
|------|---------------------|--------|
| **機能している** | ホーム、イベント一覧、スキャン（ボタン遷移）、確認、参加（モック API）、成功、永続化、同期 | イベント一覧・詳細（同期 rtCount/参加者）、参加者ログ、印刷（ブラウザ印刷）、カテゴリ一覧、ロール、ログイン画面（遷移のみ） |
| **機能していない・部分** | QR 実読み取り、成功画面の動的確認コード、時間外制御 | 印刷の動的イベント内容、QR 画像、検索フィルタ、CSV、イベント作成、QR 表示ボタン、カテゴリ編集系 |
| **未実装** | 実 QR スキャン、実 API、イベント実 API | 認証、CRUD（イベント/カテゴリ）、QR 画像、CSV、バックエンド |
